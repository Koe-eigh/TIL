# なぜ、複数のmutexでリソースを守るのか

## 疑問
mutexで共有リソースを守れるのであれば、極論、1つのmutexでリソースを守れば良くないか?

## 結論
mutexは「共有リソース1つにつき1つ」が原則であり、「システム全体で1つ」ではない。

## 理由
### そもそものmutexの目的
mutexは共有リソースの保護ということがしばしば目的として挙げられがちだが、これは半分正解ではあるが、完全に的をついた説明にはなっていない。mutexのもう一つの目的は並列処理性能を最大限引き出すことだ。mutexが一つであるということはマルチスレッドの仮面を被ったシングルスレッドシステムである。

### 目的を達成するには
mutexの目的である、「共有リソースへの同時アクセスによるリソース破壊を防ぎ、並行性を最大化する。」を達成するには、lock区間を細かく分割し、一貫性が求められる境界ごとにlockすれば良い。つまり、一貫性が求められる共有リソース1つにつき、1つのmutexを持ち、そのリソースにアクセスする場合は対応するmutexで**短く**lockする。これによって、共有リソースを守りつつ、並行性を最大化することが可能である。